#!/usr/bin/env bash
#MISE alias="t"
#MISE description="`mise test` or `mise run t`"

# https://github.com/shunk031/dotfiles/blob/master/scripts/run_unit_test.sh

set -euo pipefail

PATH="$PATH:$HOME/.local/bin"

main() {
  local jobs="${TEST_JOBS:-$(nproc)}"
  if ! command -v parallel >/dev/null; then
    jobs=1
  fi
  set -x
  bats \
    --jobs "$jobs" \
    --print-output-on-failure \
    --show-output-of-passing-tests \
    --timing \
    --recursive ./test "$@"
}

main "$@"

{{- $sandboxEnabled := false -}}
{{- $model := "sonnet" -}}
{{- /* $model := "sonnet[1m]" */ -}}
{{- $plugins := list
  "beads@beads-marketplace"
  "claude-code-setup@claude-plugins-official"
  "claude-dashboard@claude-dashboard"
  "claude-md-management@claude-plugins-official"
  "code-review@claude-plugins-official"
  "code-simplifier@claude-plugins-official"
  "commit-commands@claude-plugins-official"
  "feature-dev@claude-plugins-official"
  "frontend-design@claude-plugins-official"
  "hookify@claude-plugins-official"
  "local@local"
  "security-guidance@claude-plugins-official"
  "semgrep@claude-plugins-official"
  "skill-creator@claude-plugins-official"
-}}
{{- $plugins := concat $plugins (env "CLAUDE_CODE_PLUGINS" | splitList ",") | sortAlpha -}}
{{- /* "agent-sdk-dev@claude-plugins-official" */ -}}
{{- /* "github@claude-plugins-official": true, */ -}}
{{- /* "gitlab@claude-plugins-official": true, */ -}}
{{- /* "greptile@claude-plugins-official": true, */ -}}
{{- /* "php-lsp@claude-plugins-official": true, */ -}}
{{- /* "plugin-dev@claude-plugins-official": true, */ -}}
{{- /* "pr-review-toolkit@claude-plugins-official": true, */ -}}
{{- /* "supabase@claude-plugins-official": true */ -}}
{{- /* "typescript-lsp@claude-plugins-official": true, */ -}}
{
  "$schema": "https://json.schemastore.org/claude-code-settings.json",
  "alwaysThinkingEnabled": false,
  "autoUpdates": false,
  "enableAllProjectMcpServers": false,
  "enabledPlugins": {
    {{- range $index, $value := $plugins }}
    {{ $value | quote }}: true{{ if ne (add $index 1) (len $plugins) }},{{ end }}
    {{- end }}
  },
  "env": {
    "CLAUDE_CODE_ENABLE_TELEMETRY": "1",
    "CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS": "1",
    "OTEL_EXPORTER_OTLP_ENDPOINT": "http://localhost:4317",
    "OTEL_EXPORTER_OTLP_PROTOCOL": "grpc",
    "OTEL_LOGS_EXPORTER": "otlp",
    "OTEL_LOG_TOOL_DETAILS": "1",
    "OTEL_LOG_USER_PROMPTS": "1",
    "OTEL_METRICS_EXPORTER": "otlp",
    "XDG_CACHE_HOME": "{{ .chezmoi.homeDir }}/.cache",
    "XDG_CONFIG_HOME": "{{ .chezmoi.homeDir }}/.config",
    "XDG_DATA_HOME": "{{ .chezmoi.homeDir }}/.local/share",
    "XDG_STATE_HOME": "{{ .chezmoi.homeDir }}/.local/state"
  },
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "{{ .chezmoi.homeDir }}/.claude/hooks/lint.sh"
          }
        ]
      }
    ],
    "PreCompact": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": "bd prime 2>/dev/null || true"
          }
        ]
      }
    ],
    "SessionStart": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": "bd prime 2>/dev/null || true"
          }
        ]
      }
    ]
  },
  "model": {{ $model | quote }},
  "permissions": {
    "allow": [
      "Bash(BEADS_DIR=~/.local/share/beads bd blocked)",
      "Bash(BEADS_DIR=~/.local/share/beads bd blocked *)",
      "Bash(BEADS_DIR=~/.local/share/beads bd config get *)",
      "Bash(BEADS_DIR=~/.local/share/beads bd config list)",
      "Bash(BEADS_DIR=~/.local/share/beads bd doctor)",
      "Bash(BEADS_DIR=~/.local/share/beads bd doctor *)",
      "Bash(BEADS_DIR=~/.local/share/beads bd graph)",
      "Bash(BEADS_DIR=~/.local/share/beads bd graph *)",
      "Bash(BEADS_DIR=~/.local/share/beads bd list)",
      "Bash(BEADS_DIR=~/.local/share/beads bd list *)",
      "Bash(BEADS_DIR=~/.local/share/beads bd onboard)",
      "Bash(BEADS_DIR=~/.local/share/beads bd onboard *)",
      "Bash(BEADS_DIR=~/.local/share/beads bd preflight)",
      "Bash(BEADS_DIR=~/.local/share/beads bd prime)",
      "Bash(BEADS_DIR=~/.local/share/beads bd prime *)",
      "Bash(BEADS_DIR=~/.local/share/beads bd query *)",
      "Bash(BEADS_DIR=~/.local/share/beads bd ready)",
      "Bash(BEADS_DIR=~/.local/share/beads bd ready *)",
      "Bash(BEADS_DIR=~/.local/share/beads bd search *)",
      "Bash(BEADS_DIR=~/.local/share/beads bd show *)",
      "Bash(BEADS_DIR=~/.local/share/beads bd stale)",
      "Bash(BEADS_DIR=~/.local/share/beads bd stale *)",
      "Bash(BEADS_DIR=~/.local/share/beads bd stats)",
      "Bash(BEADS_DIR=~/.local/share/beads bd stats *)",
      "Bash(BEADS_DIR=~/.local/share/beads bd version)",
      "Bash(BEADS_DIR=~/.local/share/beads bd where)",
      "Bash(bd blocked)",
      "Bash(bd blocked *)",
      "Bash(bd config get *)",
      "Bash(bd config list)",
      "Bash(bd doctor)",
      "Bash(bd doctor *)",
      "Bash(bd graph)",
      "Bash(bd graph *)",
      "Bash(bd list)",
      "Bash(bd list *)",
      "Bash(bd onboard)",
      "Bash(bd onboard *)",
      "Bash(bd preflight)",
      "Bash(bd prime)",
      "Bash(bd prime *)",
      "Bash(bd query *)",
      "Bash(bd ready)",
      "Bash(bd ready *)",
      "Bash(bd search *)",
      "Bash(bd show *)",
      "Bash(bd stale)",
      "Bash(bd stale *)",
      "Bash(bd stats)",
      "Bash(bd stats *)",
      "Bash(bd version)",
      "Bash(bd where)",
      "Bash(bd worktree info)",
      "Bash(bd worktree list)",
      "Bash(basename *)",
      "Bash(claude mcp get *)",
      "Bash(claude mcp list)",
      "Bash(claude plugin list)",
      "Bash(cat *)",
      "Bash(column *)",
      "Bash(cut *)",
      "Bash(date *)",
      "Bash(date)",
      "Bash(diff *)",
      "Bash(dirname *)",
      "Bash(du *)",
      "Bash(echo *)",
      "Bash(fd *)",
      "Bash(file *)",
      "Bash(find *)",
      "Bash(gh issue list *)",
      "Bash(gh issue status *)",
      "Bash(gh issue view *)",
      "Bash(gh pr checks *)",
      "Bash(gh pr diff *)",
      "Bash(gh pr list *)",
      "Bash(gh pr status *)",
      "Bash(gh pr view *)",
      "Bash(gh release list *)",
      "Bash(gh release view *)",
      "Bash(gh repo view *)",
      "Bash(gh run list *)",
      "Bash(gh run view *)",
      "Bash(gh search *)",
      "Bash(git describe *)",
      "Bash(git diff *)",
      "Bash(git diff)",
      "Bash(git fetch *)",
      "Bash(git log *)",
      "Bash(git remote -v *)",
      "Bash(git remote -v)",
      "Bash(git show *)",
      "Bash(git stash list *)",
      "Bash(git stash list)",
      "Bash(git status *)",
      "Bash(git status)",
      "Bash(git worktree list *)",
      "Bash(glab ci list *)",
      "Bash(glab ci status *)",
      "Bash(glab ci view *)",
      "Bash(glab issue list *)",
      "Bash(glab issue view *)",
      "Bash(glab mr diff *)",
      "Bash(glab mr list *)",
      "Bash(glab mr view *)",
      "Bash(glab repo view *)",
      "Bash(grep *)",
      "Bash(head *)",
      "Bash(jq *)",
      "Bash(ls *)",
      "Bash(mise current *)",
      "Bash(mise list *)",
      "Bash(pwd)",
      "Bash(readlink *)",
      "Bash(realpath *)",
      "Bash(rg *)",
      "Bash(sed *)",
      "Bash(sleep *)",
      "Bash(sort *)",
      "Bash(sq *)",
      "Bash(stat *)",
      "Bash(tail *)",
      "Bash(test *)",
      "Bash(tr *)",
      "Bash(true)",
      "Bash(uname *)",
      "Bash(uniq *)",
      "Bash(wc *)",
      "Bash(which *)",
      "Bash(whoami)",
      "Bash(xxd)",
      "Bash(yq *)",
      "Glob",
      "Grep",
      "KillShell",
      "LS",
      "LSP",
      "NotebookRead",
      "Read",
      "Read(~/.local/share/memory/**.md)",
      "Task",
      "TaskCreate",
      "TaskGet",
      "TaskList",
      "TaskOutput",
      "TaskStop",
      "TaskUpdate",
      "ToolSearch",
      "WebFetch(domain:api.github.com)",
      "WebFetch(domain:docs.anthropic.com)",
      "WebFetch(domain:docs.gitlab.com)",
      "WebFetch(domain:gist.github.com)",
      "WebFetch(domain:github.com)",
      "WebFetch(domain:gitlab.com)",
      "WebFetch(domain:raw.githubusercontent.com)",
      "Skill(beads:blocked)",
      "Skill(beads:list)",
      "Skill(beads:ready)",
      "Skill(beads:search)",
      "Skill(beads:show)",
      "Skill(beads:stats)",
      "Skill(beads:version)",
      "WebSearch",
      "mcp__claude-context__*",
      "mcp__context7__*",
      "mcp__deep-wiki__*",
      "mcp__grep_app__*"
    ],
    "ask": [
      "Bash(awk *)",
      "Bash(env)",
      "Bash(env *)",
      "Bash(export *)",
      "Bash(unset *)",
      "Bash(fd * --exec *)",
      "Bash(fd * --exec-batch *)",
      "Bash(fd * -X *)",
      "Bash(fd * -x *)",
      "Bash(fd --exec*)",
      "Bash(fd -X*)",
      "Bash(fd -x*)",
      "Bash(find * -delete*)",
      "Bash(find * -exec *)",
      "Bash(find * -execdir *)",
      "Bash(find * -fprint*)",
      "Bash(find * -ok *)",
      "Bash(find * -okdir *)",
      "Bash(find -delete*)",
      "Bash(find -exec*)",
      "Bash(find -fprint*)",
      "Bash(find -ok*)",
      "Bash(printenv)",
      "Bash(printenv *)",
      "Bash(rm *)",
      "Bash(sed * -I*)",
      "Bash(sed * -i*)",
      "Bash(sed -I*)",
      "Bash(sed -i*)",
      "Bash(sort * --output *)",
      "Bash(sort * -o *)",
      "Bash(sort --output*)",
      "Bash(sort -o*)",
      "Bash(sq * --output*)",
      "Bash(sq * -o*)",
      "Bash(sq --output*)",
      "Bash(sq -o*)",
      "Bash(trash *)",
      "Bash(yq * --inplace *)",
      "Bash(yq * -i *)",
      "Bash(yq --inplace*)",
      "Bash(yq -i*)",
      "Edit",
      "ExitPlanMode",
      "MultiEdit",
      "NotebookEdit",
      "Skill",
      "Write"
    ],
    "defaultMode": "default",
    "deny": [
      "Edit(**/*.key)",
      "Edit(**/*.pem)",
      "Edit(**/*.pfx)",
      "Edit(./**/.env)",
      "Edit(./**/.env.*)",
      "Edit(./secrets/**)",
      "Edit(~/.ssh/**)",
      "Read(**/*.key)",
      "Read(**/*.pem)",
      "Read(**/*.pfx)",
      "Read(./**/.env)",
      "Read(./**/.env.*)",
      "Read(./secrets/**)",
      "Read(~/.ssh/**)",
      "TodoWrite",
      "Write(**/*.key)",
      "Write(**/*.pem)",
      "Write(**/*.pfx)",
      "Write(./**/.env)",
      "Write(./**/.env.*)",
      "Write(./secrets/**)",
      "Write(~/.ssh/**)"
    ],
    "disableBypassPermissionsMode": "disable"
  },
  "sandbox": {
    "allowUnsandboxedCommands": false,
    "autoAllowBashIfSandboxed": true,
    "enabled": {{ $sandboxEnabled }},
    "network": {
      "allowedDomains": [
        "*.github.com",
        "*.githubusercontent.com",
        "*.gitlab.com",
        "*.npmjs.org",
        "registry.yarnpkg.com",
        "{{ env "GITLAB_HOST" | default "gitlab.com" }}"
      ]
    }
  },
  "skills": {
    "audit": true,
    "beads:quickstart": false,
    "claude-automation-recommender": true,
    "claude-dashboard:check-usage": true,
    "claude-dashboard:setup": true,
    "claude-dashboard:update": true,
    "claude-md-improver": true,
    "claude-md-management:revise-claude-md": true,
    "cleanup": true,
    "code-review:code-review": true,
    "code-simplifier:code-simplifier": true,
    "commit-commands:clean_gone": true,
    "commit-commands:commit": true,
    "commit-commands:commit-push-pr": true,
    "feature-dev:feature-dev": true,
    "frontend-design": true,
    "hookify:configure": true,
    "hookify:help": true,
    "hookify:hookify": true,
    "hookify:list": true,
    "hookify:writing-rules": true,
    "journal": true,
    "keybindings-help": true,
    "local:sq": true,
    "reflect": true,
    "skill-creator": false,
    "standup": true
  },
  "statusLine": {
    "type": "command",
    "command": "{{ lookPath "node" }} ~/.claude/plugins/cache/claude-dashboard/claude-dashboard/1.10.0/dist/index.js"
  }
}

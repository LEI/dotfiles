#!/bin/sh

set -eu

. "$CHEZMOI_WORKING_TREE/home/.chezmoitemplates/helpers.sh"

{{ includeTemplate "xdg.sh.tmpl" . | trim }}

{{- if .features.ai }}

# if [ -d "$HOME/.claude" ] && [ -d "$CLAUDE_CONFIG_DIR" ]; then
#   echo >&2 "ERR: $HOME/.claude"
#   exit 1
# fi

# https://github.com/anthropics/claude-code/issues/1455
# if [ -d "$HOME/.claude" ] && ! [ -d "$CLAUDE_CONFIG_DIR" ]; then
#   dry_run mv "$HOME/.claude" "$CLAUDE_CONFIG_DIR"
#   dry_run ln -s "$CLAUDE_CONFIG_DIR" "$HOME/.claude"
# fi

# https://github.com/badlogic/pi-mono/issues/534
if [ -d "$HOME/.pi" ] && ! [ -d "$PI_CONFIG_DIR" ]; then
  dry_run mv "$HOME/.pi" "$PI_CONFIG_DIR"
  dry_run ln -s "$PI_CONFIG_DIR" "$HOME/.pi"
fi
{{- end }}

{{- if .features.docker }}

if [ -d ~/.docker ] && ! [ -d "$DOCKER_CONFIG" ]; then
  dry_run mv ~/.docker "$DOCKER_CONFIG"
fi
{{- end }}

{{- if .features.go }}

if [ -d ~/go ] && ! [ -d "$GOPATH" ]; then
  dry_run mv ~/go "$GOPATH"
fi
{{- end }}

{{- if .features.node }}

# if [ -d ~/.node_modules ] && ! [ -d "$npm_config_prefix" ]; then
#   dry_run mv ~/.node_modules "$npm_config_prefix"
# fi

if [ -d ~/Library/pnpm ] && ! [ -d "$PNPM_HOME" ]; then
  dry_run mv ~/Library/pnpm "$PNPM_HOME"
fi
{{- end }}

{{- if .features.rust }}

if [ -d "$XDG_DATA_HOME/gem" ] && ! [ -d ~/.gem ]; then
  ln -s "$XDG_DATA_HOME/gem" ~/.gem
fi
{{- end }}

{{- if .features.rust }}

if [ -d ~/.cargo ] && ! [ -d "$CARGO_HOME" ]; then
  dry_run mv ~/.cargo "$CARGO_HOME"
fi

if [ -d ~/.rustup ] && ! [ -d "$RUSTUP_HOME" ]; then
  dry_run mv ~/.rustup "$RUSTUP_HOME"
fi
{{- end }}

{{- if lookPath "xauth" | isExecutable }}

# https://askubuntu.com/a/961459
# if [ -d ~/.Xauthority ] && ! [ -d "$XAUTHORITY" ]; then
#   dry_run mv ~/.Xauthority "$XAUTHORITY"
#   dry_run ln -s "$XAUTHORITY" ~/.Xauthority
# fi
{{- end }}
